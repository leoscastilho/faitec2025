% Define o tipo de Documento. Usado para condicionar elementos textuais
\def\@monografia{Monografia}
\def\@projeto{Projeto de Pesquisa}
\def\@relatorio{Relatório de Estágio}
\def\@trabalhos{Trabalhos acadêmicos}

% Definições por grupos de elementos textuais
\newenvironment{ElementosPreTextuais}{
    \pagestyle{numbered}
}{}

\newenvironment{ElementosTextuais}{
    \clearpage
    \setcounter{savepage}{\value{page}} % Salva o número da página atual
    \pagenumbering{arabic}
    \setcounter{page}{\value{savepage}} % Restaura o número da página
    \pagestyle{numbered}
}{
    \newpage
}

\newenvironment{ElementosPosTextuais}{
    \clearpage
    \pagestyle{numbered}
}{}

% --- 1. Define boxes for ALL variable-height sections ---
\newsavebox{\headerbox}
\newsavebox{\authorbox}
\newsavebox{\footerbox}

% The Environment Definition
\newenvironment{CapaOuFalsaFolhaDeRosto}{
    \pagenumbering{roman}
    \pagestyle{numbered}
    \setcounter{page}{1}
    \thispagestyle{empty}
    %
    % --- 2. Capture ALL sections into their respective boxes to measure them ---
    \begin{lrbox}{\headerbox}
        \begin{minipage}{\textwidth}
            \centering
            \textbf{\instituicao} \\
            \textbf{\curso}
        \end{minipage}
    \end{lrbox}
    %
    \begin{lrbox}{\authorbox}
        \begin{minipage}{\textwidth}
            \centering
            \imprimirautores
        \end{minipage}
    \end{lrbox}
    %
    \begin{lrbox}{\footerbox}
        \begin{minipage}{\textwidth}
            \centering
            \textbf{\local} \\
            \textbf{\ano}
        \end{minipage}
    \end{lrbox}
    %
    \begin{center}
}{
    % --- 3. The new, perfectly symmetrical layout ---
    
    % --- Top Group (Real content + Phantoms of bottom content) ---
    \usebox{\headerbox}
    \vfill
    \usebox{\authorbox}
    \phantom{\usebox{\footerbox}} % Phantom to balance the real footer
    
    \vfill
    
    % --- The Title, now in the absolute page center ---
    \textbf{\fontsize{12}{14}\selectfont\MakeUppercase{\titulo: \subtitulo}}
    
    \vfill
    
    % --- Bottom Group (Real content + Phantoms of top content) ---
    \phantom{\usebox{\authorbox}} % Phantom to balance the real authors
    \vfill
    \phantom{\usebox{\headerbox}} % Phantom to balance the real header
    \usebox{\footerbox}
    
    \end{center}
    \newpage
}

\newenvironment{FolhaDeRosto}{
    \begin{center}
}{
    \textbf{\instituicao}

    \textbf{\curso}
    
    \vspace{2\baselineskip}

    \vfill

    \imprimirautores

    \vspace{2\baselineskip}

    
    \vfill
    
    \textbf{\fontsize{12}{14}\selectfont\MakeUppercase{\titulo: \subtitulo}}
    
    \vfill

    {\singlespacing\justifying\hspace{7cm}\parbox{\dimexpr\textwidth-7cm}{
    \natureza
    }}

    \vfill
    \textbf{\local}\\
    \textbf{\ano}
    \end{center}
    \newpage
}

\newenvironment{FolhaDeAprovacao}{
    \begin{center}
    \fontsize{12}{14}\selectfont
    \bfseries
}{
    \instituicao

    \curso

    \end{center}

    \vfill

    \textbf{AUTORES:} \imprimirautores
    \textbf{TÍTULO:} \textbf{\fontsize{12}{14}\selectfont\MakeUppercase{\titulo}}

    \vfill
    
    \textbf{BANCA EXAMINADORA}

    \vspace{2\baselineskip}

    \imprimirbancaexaminadora

    \textbf\local \quad \textbf{\fontsize{12}{14}\selectfont\MakeUppercase{\_\_/\_\_/\_\_.}}

    \newpage
}

\newenvironment{Dedicatoria}{
    \vspace*{\fill}
    \begin{flushright}
    \begin{minipage}{0.5\textwidth}
    \raggedleft
    \singlespacing
    \justifying
}{
    \end{minipage}
    \end{flushright}
    \vspace{1cm}
    \newpage
}

\newenvironment{Agradecimentos}{
    \begin{center}
    \textbf{AGRADECIMENTOS}
    \end{center}
}{
    \newpage
}

\newenvironment{Epigrafe}{
    \vspace*{\fill}
    \begin{flushright}
    \begin{minipage}{0.5\textwidth}
    \raggedleft
    \singlespacing
    \justifying
}{
    \end{minipage}
    \end{flushright}
    \vspace{1cm}
    \newpage
}

\newenvironment{Resumo}{
    \begin{center}
    \textbf{RESUMO}
    \end{center}
    
    \justifying
    \begin{singlespace}
    \resumo
    \end{singlespace}
    
    \textbf{Palavras-chave:} \palavraschave
    
    \vspace{1cm}
    \begin{center}
    \textbf{ABSTRACT}
    \end{center}
    
    \justifying
    \begin{singlespace}
    \resumoingles
    \end{singlespace}
    
    \textbf{Keywords:} \palavraschaveingles
}{
    \newpage
}


% Comandos para listas condicionais de ilustrações
% Usando sistema de duas passadas com arquivo auxiliar

% Comandos auxiliares para verificar quantidades
\makeatletter
\newcommand{\ifmorethanninefiguras}[2]{\ifnum\@totalfiguras>9\relax #1\else #2\fi}
\newcommand{\ifmorethanninetotos}[2]{\ifnum\@totalfotografias>9\relax #1\else #2\fi}
\newcommand{\ifmorethanninegraficos}[2]{\ifnum\@totalgraficos>9\relax #1\else #2\fi}
\newcommand{\ifmorethanninequadros}[2]{\ifnum\@totalquadros>9\relax #1\else #2\fi}

\newcommand{\iflessthantenfiguras}[2]{\ifnum\@totalfiguras<10\relax #1\else #2\fi}
\newcommand{\iflessthantenfotos}[2]{\ifnum\@totalfotografias<10\relax #1\else #2\fi}
\newcommand{\iflessthantengraficos}[2]{\ifnum\@totalgraficos<10\relax #1\else #2\fi}
\newcommand{\iflessthantenquadros}[2]{\ifnum\@totalquadros<10\relax #1\else #2\fi}

\newcommand{\ifhasanyillustration}[2]{%
  \newif\ifanyillustration%
  \anyillustrationfalse%
  \ifnum\@totalfiguras>0\relax \ifnum\@totalfiguras<10\relax \anyillustrationtrue\fi\fi%
  \ifnum\@totalfotografias>0\relax \ifnum\@totalfotografias<10\relax \anyillustrationtrue\fi\fi%
  \ifnum\@totalgraficos>0\relax \ifnum\@totalgraficos<10\relax \anyillustrationtrue\fi\fi%
  \ifnum\@totalquadros>0\relax \ifnum\@totalquadros<10\relax \anyillustrationtrue\fi\fi%
  \ifanyillustration#1\else#2\fi%
}

\makeatother

% Lista unificada de ilustrações (quando há menos de 2 de algum tipo)
\newcommand{\ListaDeIlustracoes}{%
    % Verifica se alguma categorias têm menos de 9 itens
    \ifhasanyillustration{%
        \clearpage
        \begin{center}
        \textbf{LISTA DE ILUSTRAÇÕES}
        \vspace{0.3cm}
        \end{center}
        % Inclui figuras se existirem
        \iflessthantenfiguras{\listoffigura}{}%
        % Inclui fotografias se existirem
        \iflessthantenfotos{\listoffotografia}{}%
        % Inclui gráficos se existirem
        \iflessthantengraficos{\listofgrafico}{}%
        % Inclui quadros se existirem
        \iflessthantenquadros{\listofquadro}{}%
        \clearpage
    }{}%
}

\newcommand{\ListaDeFiguras}{%
    % Só mostra lista individual se há 10 ou mais figuras
    \ifmorethanninefiguras{%
        \clearpage
        \begin{center}
        \textbf{LISTA DE FIGURAS}
        \vspace{0.3cm}
        \end{center}
        \listoffigura
        \clearpage
    }{}%
}

\newcommand{\ListaDeFotografias}{%
    % Só mostra lista individual se há 10 ou mais fotografias
    \ifmorethanninetotos{%
        \clearpage
        \begin{center}
        \textbf{LISTA DE FOTOGRAFIAS}
        \vspace{0.3cm}
        \end{center}
        \listoffotografia
        \clearpage
    }{}%
}

\newcommand{\ListaDeGraficos}{%
    % Só mostra lista individual se há 10 ou mais gráficos
    \ifmorethanninegraficos{%
        \clearpage
        \begin{center}
        \textbf{LISTA DE GRÁFICOS}
        \vspace{0.3cm}
        \end{center}
        \listofgrafico
        \clearpage
    }{}%
}

\newcommand{\ListaDeQuadros}{%
    % Só mostra lista individual se há 10 ou mais quadros
    \ifmorethanninequadros{%
        \clearpage
        \begin{center}
        \textbf{LISTA DE QUADROS}
        \vspace{0.3cm}
        \end{center}
        \listofquadro
        \clearpage
    }{}%
}

\newenvironment{ListaDeTabelas}{
    
}{}

% ============================================================================
% SISTEMA DE SIGLAS E ABREVIATURAS AUTOMÁTICO
% ============================================================================
\newcounter{siglacount} % Create a counter for siglas
\newtoks\siglacontent % Create a temporary storage for siglas

% Modified sigla command that increments counter and stores content
\newcommand{\sigla}[2]{%
  \stepcounter{siglacount}%
  \siglacontent\expandafter{\the\siglacontent #1 \> - \quad #2 \\}%
}

% Modified environment that checks the counter
\newenvironment{ListaAbrevESiglas}{%
  % Reset counter and content at the beginning
  \setcounter{siglacount}{0}%
  \siglacontent{}%
}{%
  % Only display if more than 9 siglas
  \ifnum\value{siglacount}>9
    \clearpage
    \begin{center}
    \textbf{LISTA DE ABREVIATURAS E SIGLAS}
    \end{center}
    \vspace{0.5cm}
    \begin{tabbing}
    \hspace{2cm} \= \kill % Set tab stop at 2.5cm
    \the\siglacontent
    \end{tabbing}
    \clearpage
  \fi
}
% ============================================================================

\newenvironment{ListaDeSimbolos}{
    
}{}

\newenvironment{Sumario}{
    \clearpage
    \tableofcontents
    \thispagestyle{numbered}
    \clearpage
}{}

\newenvironment{Introducao}{
    
}{}

\newenvironment{Desenvolvimento}{
    
}{}

\newenvironment{Conclusao}{
    
}{}

\newenvironment{Referencias}{
    \thispagestyle{empty} % Remove numeração da primeira página
    \addcontentsline{toc}{subsection}{REFERÊNCIAS} % Adiciona ao sumário
    \singlespacing % Espaçamento simples para bibliografia
}{
    \printbibliography[notcategory=exclude,heading=bibliography]
}

% ============================================================================
% SISTEMA DE GLOSSÁRIO AUTOMÁTICO
% ============================================================================
\newcounter{glossarycount} % Create a counter for glossary entries
\newtoks\glossarycontent % Create a temporary storage for glossary content

% Command to add a glossary entry, taking the term and its definition
\newcommand{\glossario}[2]{%
  \glossarycontent\expandafter{\the\glossarycontent \textbf{#1:} #2 \\ [0.8em]}%
}

% Environment that checks the counter and prints the glossary if needed
\newenvironment{Glossario}{%
  \glossarycontent{}%
}{
    \clearpage
    \addcontentsline{toc}{subsection}{GLOSSÁRIO}
    \begin{center}
    \textbf{GLOSSÁRIO}
    \end{center}
    \vspace{0.5cm}
    \the\glossarycontent
    \clearpage
}
% ============================================================================

% ============================================================================
% SISTEMA DE APÊNDICES AUTOMÁTICO
% ============================================================================

\newcommand{\myAppendixHeading}[1]{%
    \vspace{2em}%
    \begin{center}%
    \Large\bfseries #1%
    \end{center}%
    \vspace{1em}%
}

% Contador para apêndices
\newcounter{appendixcounter}
\setcounter{appendixcounter}{0}
\renewcommand{\theappendixcounter}{\Alph{appendixcounter}}

% Comando para processar uma entrada de apêndice
\newcommand{\apendice}[3]{%
    % #1: filename (without .tex)
    % #2: Title for the appendix
    % #3: Custom label for cross-referencing
    \IfFileExists{apendices/#1.tex}{%
        \refstepcounter{appendixcounter}%
        \clearpage%
        \thispagestyle{numbered}%
        {\noindent\normalsize APÊNDICE \Alph{appendixcounter} -- \MakeUppercase{#2}}%
        \vspace{1em}%
        \addtocontents{toc}{%
            \protect\vspace{0em}%
            \protect\noindent\normalsize APÊNDICE \Alph{appendixcounter} -- \MakeUppercase{#2}%
            \protect\cftdotfill{\cftdotsep}\normalsize\thepage\protect\par%
        }%
        \label{#3}% <-- Updated line
        \input{apendices/#1}%
        \clearpage
    }{%
        \PackageWarning{appendix}{Arquivo apendices/#1.tex não encontrado}%
    }%
}

% Comando para incluir todos os apêndices automaticamente
% Lê a configuração do arquivo apendices.tex
\newcommand{\includeallappendices}{%
    \IfFileExists{apendices/apendices.tex}{%
        \input{apendices/apendices.tex}%
    }{%
        \PackageError{appendix}{Arquivo apendices/apendices.tex não encontrado}{%
            Crie o arquivo apendices/apendices.tex com a lista de apêndices%
        }%
    }%
}

\newenvironment{Apendice}{
    \includeallappendices
}{}

% ============================================================================
% SISTEMA DE ANEXOS AUTOMÁTICO
% ============================================================================

\newcommand{\myAnexoHeading}[1]{%
    \vspace{2em}%
    \begin{center}%
    \Large\bfseries #1%
    \end{center}%
    \vspace{1em}%
}

% Contador para anexos
\newcounter{anexocounter}
\setcounter{anexocounter}{0}
\renewcommand{\theanexocounter}{\Alph{anexocounter}}

% Comando para processar uma entrada de apêndice
\newcommand{\anexo}[3]{%
    % #1: filename (without .tex)
    % #2: Title for the appendix
    % #3: Custom label for cross-referencing
    \IfFileExists{anexos/#1.tex}{%
        \refstepcounter{anexocounter}%
        \clearpage%
        \thispagestyle{numbered}%
        {\noindent\normalsize ANEXO \Alph{anexocounter} -- \MakeUppercase{#2}}%
        \vspace{1em}%
        \addtocontents{toc}{%
            \protect\vspace{0em}%
            \protect\noindent\normalsize ANEXO \Alph{anexocounter} -- \MakeUppercase{#2}%
            \protect\cftdotfill{\cftdotsep}\normalsize\thepage\protect\par%
        }%
        \label{#3}% <-- This is the updated line
        \input{anexos/#1}%
        \clearpage
    }{%
        \PackageWarning{appendix}{Arquivo anexos/#1.tex não encontrado}%
    }%
}

% Comando para incluir todos os anexos automaticamente
% Lê a configuração do arquivo apendices.tex
\newcommand{\includeallanexos}{%
    \IfFileExists{anexos/anexos.tex}{%
        \input{anexos/anexos.tex}%
    }{%
        \PackageError{appendix}{Arquivo anexos/anexos.tex não encontrado}{%
            Crie o arquivo anexos/anexos.tex com a lista de apêndices%
        }%
    }%
}

\newenvironment{Anexo}{
    \includeallanexos
}{}

\newenvironment{Indice}{
    
}{}